# TASKS.md - –¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏ –∏ –ø–ª–∞–Ω —Ä–∞–±–æ—Ç—ã

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. –°–∫—Ä–æ–ª–ª–∏–Ω–≥ –≤ —á–∞—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–ª–æ–º–∞–Ω
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π —Å–∫—Ä–æ–ª–ª –ø–µ—Ä–µ—Å—Ç–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ–æ–±—â–µ
- **–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ**: –ò–∑–º–µ–Ω–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ChatPage, —É–±—Ä–∞–Ω—ã –ª–∏—à–Ω–∏–µ CSS —Å–≤–æ–π—Å—Ç–≤–∞
- **–ß—Ç–æ –Ω—É–∂–Ω–æ**:
  - –í–µ—Ä–Ω—É—Ç—å –ø—Ä–æ—Å—Ç—É—é —Ä–∞–±–æ—á—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–µ–∑ flex-1/min-h-0
  - –£–±—Ä–∞—Ç—å will-change –∏ –¥—Ä—É–≥–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –≤ Telegram

### 2. –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤ - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (chat_history vs chat_answers)
- **–ß—Ç–æ –Ω—É–∂–Ω–æ**:
  - ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Supabase MCP –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î
  - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É
  - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –º–µ–∂–¥—É API endpoints

## üìã –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase —á–µ—Ä–µ–∑ MCP
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ MCP
claude mcp list

# –ï—Å–ª–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω, –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å:
claude mcp remove supabase
claude mcp add supabase npx @supabase/mcp-server-supabase@latest -- --access-token sbp_e00c9b3d34072310c63e20332ba901d4b6ea1742
```

### –®–∞–≥ 2: –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î —á–µ—Ä–µ–∑ MCP
–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü:
   - `chat_history` - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
   - `chat_answers` - —Å—Ç–∞—Ä–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–≤–æ–∑–º–æ–∂–Ω–æ deprecated)
   - `chat_sessions` - –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å sample –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã

### –®–∞–≥ 3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–∞
1. **–í–µ—Ä–Ω—É—Ç—å –ø—Ä–æ—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ ChatPage.tsx**:
   ```tsx
   <div className="fixed inset-0 overflow-hidden">
     <ChatBackground />
     <div className="relative z-10 h-full flex flex-col">
       <ChatHeader />
       <ChatMessages /> // flex-1 overflow-y-auto
       <GlassBottomBar />
     </div>
   </div>
   ```

2. **–£–±—Ä–∞—Ç—å –∏–∑ CSS**:
   - `will-change-scroll`
   - `overscroll-behavior`
   - –õ–∏—à–Ω–∏–µ fixed –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å ChatMessages.tsx**:
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ—Å—Ç–æ–π `overflow-y-auto`
   - Padding bottom –¥–ª—è GlassBottomBar

### –®–∞–≥ 4: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–æ–≤

#### 4.1 –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥)
- ‚úÖ –°–æ–∑–¥–∞–Ω ChatHistoryPopup –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–∫–æ–Ω–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –≤ —Ö–µ–¥–µ—Ä —á–∞—Ç–∞
- **–ù—É–∂–Ω–æ**:
  - –ò—Å–ø—Ä–∞–≤–∏—Ç—å API endpoints –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
  - –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å–µ—Å—Å–∏—é
  - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π —Å–µ—Å—Å–∏–∏

#### 4.2 –î–ª—è –∞–¥–º–∏–Ω–∫–∏
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–µ—Å—Å–∏–π
- **–ù—É–∂–Ω–æ**:
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å AdminChatHistory –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
  - –ò—Å–ø—Ä–∞–≤–∏—Ç—å API –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
  - –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

### –®–∞–≥ 5: –£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å–µ—Å—Å–∏–π

#### –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:
- –ö–∞–∂–¥—ã–π —Ä–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è (UUID)
- –°–µ—Å—Å–∏–∏ –Ω–µ —Å–≤—è–∑–∞–Ω—ã –º–µ–∂–¥—É —Å–æ–±–æ–π
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å—Ç–∞—Ä—ã–π —á–∞—Ç

#### –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:
1. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏**:
   - –ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
   - –ò–ª–∏ –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ > 30 –º–∏–Ω—É—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
   
2. **–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏**:
   - –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" –≤ –∏—Å—Ç–æ—Ä–∏–∏
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

3. **–•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î**:
   ```sql
   -- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ chat_history
   id: uuid
   telegram_id: string
   session_id: uuid
   message_type: 'user' | 'assistant'
   content: text
   material_ids: number[] | null
   created_at: timestamp
   ```

## üîß API ENDPOINTS –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. `/api/chat/sessions/[telegram_id]/summary`
- –ü–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–µ—Å—Å–∏–π —Å –ø—Ä–µ–≤—å—é
- –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ session_id
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: session_id, last_message, created_at, message_count

### 2. `/api/chat/session/[session_id]`
- –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ created_at ASC
- –í–∫–ª—é—á–∞–µ—Ç material_ids –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### 3. `/api/chat/sessions/[telegram_id]`
- –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏—Å—Ç–æ—Ä–∏–∏
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è (offset/limit)

### 4. `/api/admin/chat-history`
- –í—Å–µ —Å–µ—Å—Å–∏–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –§–∏–ª—å—Ç—Ä—ã: telegram_id, date range
- –í–∫–ª—é—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

## üêõ –ò–ó–í–ï–°–¢–ù–´–ï –ë–ê–ì–ò

1. **–°–∫—Ä–æ–ª–ª–∏–Ω–≥ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω** - –∫—Ä–∏—Ç–∏—á–Ω–æ!
2. **API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞–∑–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã** - chat_history vs chat_answers
3. **–ê–¥–º–∏–Ω–∫–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–µ—Å—Å–∏–∏** - –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π endpoint
4. **–ù–µ—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏** - –∫–∞–∂–¥—ã–π —á–∞—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω

## üìù –ó–ê–ú–ï–¢–ö–ò

- Project ID –≤ Supabase: `qucewyckfrnfpaiyrccv`
- –ò—Å–ø–æ–ª—å–∑—É–µ–º service role key –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- Telegram Mini App —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –í–∞–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –≤ Telegram

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Å—Å–∏–∏

- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Supabase —á–µ—Ä–µ–∑ MCP
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∫—Ä–æ–ª–ª–∏–Ω–≥ (–≤–µ—Ä–Ω—É—Ç—å –ø—Ä–æ—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É)
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å API endpoints —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–æ–≤ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∫—É
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π

## üöÄ –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ë–´–°–¢–†–û–ì–û –°–¢–ê–†–¢–ê

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev:https

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–µ—Ä–∞
npm run lint

# –î–µ–ø–ª–æ–π
git add -A
git commit -m "fix: ..."
git push
railway up
```

## ‚ö†Ô∏è –í–ê–ñ–ù–û –ü–û–ú–ù–ò–¢–¨

1. **–ù–ï –î–ï–õ–ê–¢–¨** —Å–ª–æ–∂–Ω—ã–µ CSS –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ - –æ–Ω–∏ –ª–æ–º–∞—é—Ç —Å–∫—Ä–æ–ª–ª
2. **–í–°–ï–ì–î–ê** –ø—Ä–æ–≤–µ—Ä—è—Ç—å —á–µ—Ä–µ–∑ Supabase MCP –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –ë–î
3. **–¢–ï–°–¢–ò–†–û–í–ê–¢–¨** –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –≤ Telegram
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –í—å–µ—Ç–Ω–∞–º–µ - Telegram –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –∞–≤–∞—Ç–∞—Ä–∫–∏ –º–æ–≥—É—Ç –Ω–µ –≥—Ä—É–∑–∏—Ç—å—Å—è