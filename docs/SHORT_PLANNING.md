# Краткосрочный план по реализации

## Логические основания
- **Вещь**: Редизайн компонента MainScreen для Telegram Mini App.
- **Свойства**: 
    - Яркий, светлый пользовательский интерфейс в стиле Alo Moves.
    - Компактный, минималистичный дизайн.
    - Улучшенный UX с плавными анимациями.
    - Адаптивность для разных размеров экранов.
    - Доступность (ARIA атрибуты, клавиатурная навигация).
- **Отношения**: 
    - Сохранение всей существующей логики авторизации и взаимодействия с Supabase.
    - Гармоничная интеграция с существующими компонентами.
    - Соответствие современным стандартам дизайна мобильных приложений.

## Основной фокус
Основным фокусом было создание яркого, светлого дизайна компонента MainScreen, сохраняя всю существующую бизнес-логику и функциональность:
1. Обновление дизайна с использованием светлых, ярких цветов в стиле Alo Moves
2. Создание более компактного макета для улучшения эргономики
3. Удаление лишней информации для концентрации на ключевых метриках
4. Обеспечение плавных анимаций и переходов

## Текущие задачи (следующие 1-2 дня)

### День 1: Редизайн основных компонентов
- ✅ Анализ существующего компонента MainScreen и связанных компонентов
- ✅ Обновление CSS для MainScreen с переменными для новой светлой темы
- ✅ Редизайн компонента Stats для упрощения и улучшения визуального представления
- ✅ Стилизация компонента AuthStatusIndicator для соответствия общему дизайну
- ✅ Тестирование адаптивности на разных размерах экранов

### День 2: Анимации и доступность
- ✅ Добавление CSS-анимаций для плавных переходов между состояниями
- ✅ Улучшение доступности компонентов с ARIA атрибутами
- ✅ Оптимизация для различных устройств

## Чек-лист проверки (выполненные пункты)

### Проверка визуального представления
- ✅ Соответствие яркому, светлому дизайну в стиле Alo Moves
- ✅ Корректное отображение на разных размерах экранов
- ✅ Плавные переходы и анимации между состояниями

### Проверка функциональности
- ✅ Сохранение всей существующей логики авторизации
- ✅ Корректная работа с Supabase
- ✅ Правильное отображение данных пользователя

### Проверка доступности
- ✅ Достаточный контраст текста и элементов управления
- ✅ Корректная работа с клавиатурной навигацией
- ✅ Наличие всех необходимых ARIA атрибутов

## Обнаруженные проблемы и задачи
- Необходимо обеспечить плавные переходы между состояниями компонентов
- Требуется адаптация для разных размеров экранов
- Необходима поддержка темной и светлой темы через CSS-переменные

## Результаты
- Создан яркий, светлый, минималистичный дизайн в стиле Alo Moves
- Улучшена компактность и эргономика интерфейса
- Повышена доступность и юзабилити компонентов
- Сохранена вся основная функциональность приложения

## Обнаруженные особенности
- Отказ от поддержки темной темы в пользу единой яркой светлой темы приложения
- Более компактный макет с концентрацией на ключевых метриках
- Улучшенное визуальное разделение функциональных блоков
- Исправлены мелкие ошибки типизации (fetchPriority)

## Следующие шаги
1. Добавление плавных переходов между страницами
2. Оптимизация загрузки изображений
3. Создание анимированных графиков для отображения статистики
4. Улучшение тактильной обратной связи для мобильных пользователей

# Краткосрочный план по реализации

## Основной фокус
На данный момент наш главный фокус - реализация базового потока работы приложения:
1. Вход пользователя через Telegram
2. Отображение главного экрана с рекомендациями и статистикой
3. Переход на экран квиза для выбора практики
4. Навигация между основными разделами приложения

## Текущие задачи (следующие 3-5 дней)

### День 1: Построение основного UI
- ✅ Создать `MainScreen.tsx` по документации
- ✅ Создать заготовку для `QuizFlow.tsx`
- ✅ Настроить маршрутизацию
- ◻️ Проверить корректность отображения в мобильном формате
- ◻️ Отладить взаимодействие с Supabase

### День 2: Разработка квиза
- ◻️ Спроектировать пошаговый процесс квиза
- ◻️ Создать компоненты для каждого шага квиза
- ◻️ Реализовать логику перехода между шагами
- ◻️ Добавить анимацию переходов

### День 3: Интеграция с Supabase
- ◻️ Разработать структуру таблиц для практик и рекомендаций
- ◻️ Создать хуки для работы с данными практик
- ◻️ Реализовать сохранение результатов квиза

## Чек-лист проверки

### Проверка навигации
- ✅ Переход с главной на квиз
- ◻️ Возврат с квиза на главную
- ◻️ Переход на профиль и обратно
- ◻️ Корректная работа кнопки "назад" в Telegram

### Проверка авторизации
- ✅ Отображение данных пользователя из Telegram
- ✅ Сохранение пользователя в Supabase
- ✅ Индикатор состояния авторизации (зеленая лампочка)

### Проверка UI
- ◻️ Корректное отображение на устройствах разных размеров
- ◻️ Соответствие цветовой схеме Telegram
- ◻️ Корректная работа в темной и светлой теме

## Обнаруженные проблемы
- Отсутствие компонентов `Tabs` и `TabsItem` в библиотеке `@telegram-apps/telegram-ui` - временно реализовали собственный компонент `TabBar`
- Необходимо проверить работу в реальной среде Telegram Mini App

## Следующие шаги
1. Доработать квиз до рабочего состояния
2. Реализовать интеграцию с Supabase для рекомендаций
3. Разработать страницы для библиотеки и календаря

# Краткосрочный план по исправлению ошибки подключения к Supabase

## Логические основания
- **Вещь**: Исправление ошибки подключения к Supabase в Telegram Mini App.
- **Свойства**: 
    - Ошибка внешнего ключа при создании пользователей.
    - Противоречивый статус подключения в интерфейсе.
    - Неработающая аутентификация.
- **Отношения**: 
    - Ограничение внешнего ключа в таблице public.users блокирует создание пользователей.
    - Отсутствие пользователей препятствует нормальной работе приложения.

## Задачи:
1.  [x] Проанализировать логи Vercel для выявления ошибок подключения к Supabase.
2.  [x] Обнаружить конфликтующее ограничение внешнего ключа в таблице users:
    *   [x] Определить, что ошибка связана с constraint `users_id_fkey`
    *   [x] Выяснить, что ограничение связывает `public.users.id` с `auth.users.id`
3.  [x] Исправить структуру базы данных:
    *   [x] Удалить ограничение внешнего ключа с помощью миграции SQL
4.  [x] Проверить корректность работы приложения после изменений:
    *   [x] Проверить успешную регистрацию пользователей
    *   [x] Проверить корректное отображение статуса подключения
5.  [x] Обновить документацию с информацией о решенной проблеме.

## Чек-лист проверок:
- [x] Анализ ошибок: Ошибки в логах идентифицированы и поняты.
- [x] Структура БД: Таблица users проанализирована и исправлена.
- [x] Миграция: SQL миграция выполнена успешно.
- [x] Функциональность: Проверить работу приложения после исправлений.
- [x] Документация: Обновить с информацией о решенной проблеме.

## Выводы и рекомендации:
- Удаление внешнего ключа `users_id_fkey` решило проблему с созданием пользователей.
- Добавлена переменная окружения NEXT_PUBLIC_ALLOW_BROWSER_ACCESS в локальное окружение (необходимо также добавить в Vercel).
- Приложение теперь корректно функционирует и в браузере, и в Telegram Mini App.

## Выполненные задачи

- **Исправление проблем с Supabase обновлениями ✅** - Полностью отказались от Realtime подписок, заменив их на однократное получение данных при загрузке страницы и обновление только по запросу пользователя через кнопку Refresh Data. Это устранило цикличные обновления, флюктуацию UI и избыточную нагрузку на сеть.

# Краткосрочный план по исправлению TypeScript ошибок сборки

## Логические основания
- **Вещь**: Исправление ошибок TypeScript при сборке проекта на Vercel.
- **Свойства**: 
    - Ошибки типизации в файлах Supabase клиента и утилит.
    - Неиспользуемые переменные.
    - Невалидные свойства в объектах конфигурации.
- **Отношения**: 
    - Ошибки TypeScript блокируют успешную сборку и деплой проекта.
    - Ошибки связаны с компонентами Supabase и диагностической страницей.

## Задачи:
1.  [x] Проанализировать логи сборки Vercel для выявления всех TypeScript ошибок.
2.  [x] Исправить ошибки в файле `src/lib/supabase/client.ts`:
    *   [x] Удалить свойство `debug` из объекта конфигурации `realtime` (не существует в типе `RealtimeClientOptions`).
    *   [x] Исправить обработку URL в функциях логирования (свойство `url` не существует на типе `URL`).
3.  [x] Исправить неиспользуемые переменные:
    *   [x] Удалить или использовать переменную `subscription` в `debugUtils.ts`.
    *   [x] Удалить неиспользуемый импорт `supabase` в `DiagnosticsPage.tsx`.
4.  [x] Провести локальное тестирование TypeScript компиляции для подтверждения исправлений.
5.  [x] Обновить документацию с отметкой о решенных проблемах.
6.  [x] Выполнить коммит и пуш исправлений в репозиторий.

## Чек-лист проверок:
- [x] TypeScript компиляция: Все ошибки TS должны быть устранены.
- [x] Функциональность: Исправления не должны нарушать существующую функциональность.
- [x] Документация: Обновлена с информацией о решенных проблемах.
- [x] Код: Решения должны быть оптимальными и соответствовать стилю кодбазы.
- [x] Логирование: Должно продолжать корректно работать после изменений в URL обработке.
- [x] Деплой: Необходимо проверить успешность сборки и деплоя на Vercel после внесения исправлений.

# Short-Term Plan

## Current Goal: Улучшение UI и документация Telegram UI

### Checklist & Verification:
- [x] Создать компонент `Stats` для отображения статистики пользователя
- [x] Интегрировать компонент `Stats` в главный экран
- [x] Улучшить `SafeAreaFade` для корректной работы под UI элементами Telegram
- [x] Исправить использование `Tabbar` из `@telegram-apps/telegram-ui`
- [x] Создать документацию по компонентам Telegram UI в `docs/lib_docs/TELEGRAM_UI_COMPONENTS.md`
- [x] Успешно собрать проект и проверить работу компонентов

### Navigation/Flow:
- Структура главного экрана теперь включает блок статистики "Твоя сила", "Минут практики" и "Дней в потоке"
- TabBar корректно интегрирован и использует официальные компоненты Telegram UI

### Consistency Check:
- UI компоненты (`SafeAreaFade`, `TabBar`, `Stats`) используются последовательно.
- Компонент `Stats` следует дизайну из предоставленного скриншота.
- Стили и цвета соответствуют дизайн-системе Telegram UI.

### Notes:
- Previous focus was on refining `SafeAreaFade` CSS and confirming `TabBar` implementation.